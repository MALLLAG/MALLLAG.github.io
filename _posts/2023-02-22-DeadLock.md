---
title: Dead Lock
tags: OperatingSystem
comments: true
---

# 교착 상태란

프로세스를 실행하기 위해서는 자원이 필요한데, 두 개 이상의 프로세스가 각자 가지고 있는 자원을 <br>
무작정 기다린다면 프로세스가 더 이상 진행할 수 없는 **교착 상태**가 된다.

<img width="660" alt="26" src="https://github.com/MALLLAG/TIL/assets/87420630/b76398ff-355a-433c-b180-17ca00603f59">

<br>

## 교착 상태 발생 조건

교착 상태가 발생할 조건에는 **상호 배제, 점유와 대기, 비선점, 원형 대기**가 있다. <br>
이 조건 중 하나라도 만족하지 않는다면 교착 상태가 발생하지 않지만, 모두 만족되면 교착 상태가 발생할 가능성이 생긴다.

### 상호 배제

교착 상태가 발생한 근본적인 원인은 해당 자원을 한 번에 하나의 프로세스만 이용 가능했기 때문이다. <br>
한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없는 상황에서(**상호 배제**) 교착 상태가 발생할 수 있다.


### 점유와 대기

어떤 자원을 할당받은 상태에서 다른 자원을 할당받기를 기다리는 상태를 **점유와 대기**라고 한다.

### 비선점

비선점 자원은 그 자원을 이용하는 프로세스의 작업이 끝나야만 이용할 수 있다. <br>
어떤 프로세스도 다른 프로세스의 자원을 강제로 뺏지 못했기 때문에 교착 상태가 발생할 수 있다.

### 원형 대기

프로세스들이 원의 형태로 자원을 대기하는 것을 **원형 대기**라고 한다.

<br>
<hr>

# 교착 상태 해결 방법

교착 상태를 해결하기 위해 **예방, 회피, 검출 후 회복** 세 가지 방법을 활용할 수 있다.

애초에 교착 상태가 일어나지 않도록 교착 상태 발생 조건에 부합하지 않게 자원을 분배하여 교착 상태를 **예방**할 수 있고 <br>
조금씩 자원을 할당하다가 교착 상태의 위험이 있다면 자원을 할당하지 않는 방식으로 교착 상태를 **회피**할 수 있고 <br>
자원을 제약 없이 할당하다가 교착 상태가 **검출**되면 교착 상태를 **회복**하는 방법을 취할 수도 있다.

## 교착 상태 예방

### 상호 배제 없애기

자원의 상호 배제를 없앤다는 말은 **모든 자원을 공유 가능하게 만든다**와 같은 의미이다.

다만 현실적으로 모든 자원의 상호 배제를 없애기는 어렵기에 이 방법을 사용하기에는 무리가 있다.

### 점유와 대기 없애기

점유와 대기를 없애면 운영체제는 특정 프로세스에 자원을 모두 할당하거나, 아예 할당하지 않는 방식으로 배분한다.

이 방식의 단점은 자원의 활용률이 낮아질 수 있고, 많은 자원을 사용하는 프로세스가 불리해진다.

### 비선점 조건 없애기

비선점 조건을 없애면 자원을 이용중인 프로세스로부터 해당 자원을 빼앗을 수 있다.

이 방식은 선점하여 사용할 수 있는 일부 자원에 대해 효과적이다. <br>
하지만 모든 자원이 선점 가능한 것이 아니기 때문에, 범용성이 떨어지는 방법이다.

### 원형 대기 조건 없애기

모든 자원에 번호를 붙이고, 오름차순으로 자원을 할당하면 원형 대기는 발생하지 않는다.

이 방식은 위의 방식들보다 현실적이고 실용적이지만, 단점은 있다. <br>
모든 자원에 번호를 붙이기도 어렵고, 각 자원에 어떤 번호를 붙이는지에 따라 특정 자원의 활용률이 떨어질 수 있다.

<br>

## 교착 상태 회피

**교착 상태 회피**는 교착 상태가 발생하지 않을 정도로만 자원을 할당하는 방식이다. <br>
이는 프로세스들에 배분할 수 있는 자원의 양을 고려하여 교착 상태가 발생하지 않을 정도의 양만큼만 자원을 배분한다.

> 교착 상태가 발생하지 않고 모든 프로세스가 정상적으로 자원을 할당받고 종료될 수 있는 상태를 **안전 상태**라고 부르고 <br>
> 교착 상태가 발생할 수 있는 상황을 **불안전 상태**라고 부른다. <br>
> 교착 상태없이 안전하게 프로세스들에 자원을 할당할 수 있는 순서를 의미하는 것을 **안전 순서열**이라고 한다. <br>
> 안전 순서열대로 프로세스들에 자원을 배분하여 교착 상태가 발생하지 않는 상태를 **안전 상태**라고 한다. <br>
> 반면 **불안전 상태**는 안전 순서열이 없는 상황이다. 시스템이 불안전 상태에 놓이면 교착 상태가 발생할 수 있는 위험이 있다.

<br>

## 교착 상태 검출 후 회복

**교착 상태 검출 후 회복**은 교착 상태 발생을 인정하고 사후에 조치하는 방식이다.

이 방식에서 운영체제는 프로세스들이 자원을 요구할 때마다 모두 할당하고, 교착 상태 발생 여부를 주기적으로 검사한다.

### 선점을 통한 회복

**선점을 통한 회복**은 교착 상태가 해결될 때까지 한 프로세스씩 자원을 몰아주는 방식이다.

### 프로세스 강제 종료를 통한 회복

운영체제는 교착 상태에 놓인 프로세스를 모두 강제 종료할 수도 있고, 교착 상태가 없어질 때까지 한 프로세스씩 강제 종료할 수도 있다.


